<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SSCE Examination test 2025 - SIMPLE STANDARD SCHOOL JOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style>
    body { 
      margin:0; 
      font-family:"Times New Roman", Times, serif; 
    }
    .intro-page {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100vh;
      background:linear-gradient(135deg,#eef7ff,#eaf6ff);
    }
    .glass-frame {
      background:rgba(255,255,255,0.3);
      border-radius:20px;
      backdrop-filter:blur(12px);
      padding:40px;
      box-shadow:0 8px 30px rgba(0,0,0,0.1);
    }
    .glass-frame img {
      width:200px;
      height:200px;
      object-fit:contain;
      border-radius:20px;
      border:3px solid rgba(255,255,255,0.6);
    }
    .school-name {
      font-size:2rem;
      font-weight:900;
      margin-top:20px;
      text-align:center;
      color:#0f3b68;
      text-shadow:1px 1px 3px rgba(0,0,0,0.2);
    }
    .marquee {
      color:red;
      font-weight:700;
      font-size:1.1rem;
      margin-top:20px;
      white-space:nowrap;
      overflow:hidden;
      box-sizing:border-box;
    }
    .marquee span {
      display:inline-block;
      padding-left:100%;
      animation:scrollText 12s linear infinite;
    }
    @keyframes scrollText {
      0% {
        transform:translate(0,0); 
      }
      100% {
        transform:translate(-100%,0);
      }
    }
    .btn-start {
      margin-top:40px;
      padding:12px 24px;
      border:none;
      border-radius:10px;
      background:#0b6efd;
      color:white;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(11,110,253,0.3);
    }
    .btn-start:hover {
      background:#095ed6;
    }

    :root {
      --primary: #0b6efd;
      --secondary: #0f3b68;
      --accent: #13c2c2;
      --bg: #f7fafc;
      --text: #1f2937;
      --muted: #6b7280;
      --good: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --card: #ffffff;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Times New Roman", Times, serif;
      color: var(--text);
      background: linear-gradient(135deg, #f0f7ff 0%, #eaf6ff 100%);
    }

    .brand-header {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      color: #fff;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
    }
    .brand-header img {
      height: 56px; width: 56px;
      border-radius: 12px;
      background: #fff3;
      object-fit: cover;
      border: 2px solid #ffffff22;
    }
    .brand-title { display: flex; flex-direction: column; }
    .brand-title .school { font-size: 1.1rem; letter-spacing: 0.4px; font-weight: 600; }
    .brand-title .exam { font-size: 0.95rem; color: #e6eefb; }
    .header-actions { margin-left: auto; }

    .container { max-width: 1100px; margin: 28px auto; padding: 0 16px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(10, 40, 80, 0.08);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 { margin: 0 0 10px; }
    .muted { color: var(--muted); }

    input, select, button, textarea { font: inherit; }
    .row { display: flex; gap: 14px; flex-wrap: wrap; }
    .field { flex: 1 1 280px; display: flex; flex-direction: column; gap: 6px; }
    .field input, .field select, .field textarea {
      padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px; background: #fff;
    }
    .actions { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
    .btn {
      padding: 10px 14px; border: none; border-radius: 10px; background: var(--primary); color: #fff;
      cursor: pointer; font-weight: 600; transition: transform 0.05s ease, box-shadow 0.2s ease, background 0.2s ease;
      box-shadow: 0 6px 16px rgba(11, 110, 253, 0.25);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn.secondary { background: var(--accent); box-shadow: 0 6px 16px rgba(19, 194, 194, 0.25); }
    .btn.ghost { background: #fff; color: var(--primary); border: 1px solid var(--border); box-shadow: none; }
    .btn.danger { background: var(--danger); }
    .btn.warn { background: var(--warn); color: #1f2937; }

    .exam-header {
      display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 10px;
    }
    .timer {
      background: #fff; border: 1px solid var(--border); border-radius: 12px;
      padding: 10px 14px; color: var(--secondary); font-weight: 700; display: flex; align-items: center; gap: 8px;
    }
    .pager { display: flex; gap: 8px; flex-wrap: wrap; }
    .pager .btn { padding: 8px 12px; }
    .question { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
    .question h4 { margin: 0 0 8px; }
    .options { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .options label {
      border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; cursor: pointer; background: #fafafa; display: flex; gap: 8px; align-items: center;
    }

    .number-grid {
      display: grid; grid-template-columns: repeat(10, 1fr);
      gap: 8px; background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 10px;
    }
    .num {
      text-align: center; padding: 6px 8px; border-radius: 8px; cursor: pointer;
      border: 1px solid var(--border); background: #f9fafb; user-select: none; font-weight: 600; color: var(--secondary);
    }
    .num.answered { background: #e8fff4; border-color: #a7f3d0; color: var(--good); }
    .num.active { background: #eef7ff; border-color: #bfdbfe; color: var(--primary); }

    .page { display: none; }
    .page.active { display: block; }

    .score { font-size: 1.4rem; font-weight: 700; }
    .success { color: var(--good); }
    .warning { color: var(--warn); }
    .error { color: var(--danger); }
    .footer-note { font-size: 0.9rem; color: var(--muted); }

    /* Admin styles */
    .admin-login { max-width: 480px; margin: 0 auto; }
    .admin-grid { display: grid; grid-template-columns: 260px 1fr; gap: 16px; }
    .admin-sidebar {
      background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 10px;
    }
    .admin-subject { padding: 6px 8px; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); margin-bottom: 6px; background: #f9fafb; }
    .admin-subject.active { background: #eef7ff; border-color: #bfdbfe; color: #0b6efd; }
    .question-row { border-bottom: 1px solid var(--border); padding: 8px 0; }
    .question-row:last-child { border-bottom: none; }
    .question-row input[type="text"] { width: 100%; }
    .small { font-size: 0.85rem; color: var(--muted); }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--border); background: #f3f4f6; font-size: 0.8rem; margin-left: 6px; }
    .admin-actions { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; font-size: 0.9rem; }
    th { background: #f0f0f0; }

    @media (max-width: 860px) { .admin-grid { grid-template-columns: 1fr; } }
    @media (max-width: 640px) { .options { grid-template-columns: 1fr; } .number-grid { grid-template-columns: repeat(5, 1fr); } }
  </style>
</head>
<body>
  <!-- New Intro Page -->
  <section id="page-intro" class="intro-page">
    <div class="glass-frame">
      <img src="logo.png" alt="School Logo" />
    </div>
    <div class="school-name">SIMPLE STANDARD SCHOOL JOS</div>
    <div class="marquee"><span>EXAMINATION MALPRACTICE IS EVIL, DO NOT PARTICIPATE IN IT</span></div>
    <button class="btn-start" id="enter-exam">Enter Examination Portal</button>
  </section>
  
  <header class="brand-header">
    <img id="school-logo" src="logo.png" alt="School Logo" />
    <div class="brand-title">
      <div class="school">SIMPLE STANDARD SCHOOL JOS</div>
      <div class="exam">SSCE Examination test 2025</div>
    </div>
    <div class="header-actions">
      <button class="btn ghost" id="go-admin">Admin Panel</button>
      <button class="btn ghost" id="home-header-btn">Home</button>
    </div>
  </header>

  <main class="container">

    <section id="page-landing" class="page active card">
      <h2>Candidate verification</h2>
      <div class="actions">
        
        <button class="btn" id="home-btn-landing">🏠 Home</button>

      </div>
      <p class="muted">Select your name and exam number to proceed.</p>

      <div class="field">
        <label for="student-select">Choose Student</label>
        <select id="student-select">
          <option value="">-- Select Student --</option>
        </select>
      </div>

      <div class="actions">
        <button class="btn" id="proceed-landing">Proceed</button>
      </div>

      <div class="footer-note">
        SIMPLE STANDARD SCHOOL JOS •    SSCE Examination test 2025
      </div>
    </section>

    
    <section id="page-select" class="page card">
      <h2>Welcome</h2>
      <p id="welcome-text" class="muted"></p>
      <div class="row">
        <div class="field">
          <label for="subject-select">Select a subject (9 assigned)</label>
          <select id="subject-select"></select>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="proceed-exam">Proceed to test</button>
        <button class="btn ghost" id="back-to-landing">Back</button>
      </div>
    </section>

    <section id="page-exam" class="page card">
      <div class="exam-header">
        <div>
          <h2 id="exam-subject-title">Subject</h2>
          <div class="muted" id="exam-student-info"></div>
        </div>
        <div class="timer" id="timer">Time left: 30:00</div>
      </div>
      <div class="number-grid" id="number-grid"></div>
      <div id="questions-container"></div>
      <div class="pager">
        <button class="btn ghost" id="prev-page">Previous page</button>
        <button class="btn ghost" id="next-page">Next page</button>
        <button class="btn secondary" id="submit-exam">Submit</button>
      </div>
    </section>

    <section id="page-result" class="page card">
      <h2>Result</h2>
      <p id="result-summary" class="score"></p>
      <div class="actions">
        <button class="btn" id="download-pdf">Download PDF</button>
        <button class="btn secondary" id="email-pdf">Email PDF to school</button>
        <button class="btn ghost" id="new-subject">Take another subject</button>
      </div>
      <p class="footer-note">Result includes school name & logo, exam title, student name & number, subject, and marks.</p>
    </section>
    
    <section id="page-admin" class="page card">
      <h2>Admin panel</h2>
      <div id="admin-auth" class="admin-login">
        <p class="muted">Enter credentials to manage question banks and view results.</p>
        <div class="field">
          <label for="admin-name">Admin name</label>
          <input id="admin-name" type="text" placeholder=" " />
        </div>
        <div class="field">
          <label for="admin-pass">Admin password</label>
          <input id="admin-pass" type="password" placeholder=" " />
        </div>
        <div class="actions">
          <button class="btn" id="admin-login-btn">Login</button>
          <button class="btn ghost" id="admin-back">Back</button>
        </div>
      </div>

      <div id="admin-area" style="display:none;">
        <div class="admin-actions">
          <button class="btn warn" id="regen-banks">Regenerate all questions</button>
          <button class="btn secondary" id="save-banks">Save banks to localStorage</button>
          <button class="btn ghost" id="load-banks">Load banks from localStorage</button>
          <button class="btn ghost" id="back-admin-home">🔙 Back to Home</button>          
          <span class="small">Editing affects future exams. Each subject has 100 questions.</span>
        </div>
        <div class="admin-grid" style="margin-top:16px;">
          <div class="admin-sidebar" id="admin-subject-list"></div>
          <div class="card" id="admin-editor">
            <h3 id="admin-subject-title" style="margin-top:0;">Subject</h3>
            <div id="admin-question-list"></div>
          </div>
        </div>
        <div class="card" id="admin-results">
          <h3>Submitted Results</h3>
          <table id="results-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Exam Number</th>
                <th>Department</th>
                <th>Subject</th>
                <th>Score</th>
                <th>Percentage</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

  </main>

  <!-- External libs: jsPDF & EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    // Initialize EmailJS
    (function(){
      emailjs.init("-iORU9eAl7NrqYAqb"); // Your EmailJS user ID
    })();

    const school = {
      name: "SIMPLE STANDARD SCHOOL JOS",
      examTitle: "SSCE Examination test 2025",
      email: "mkdu7562@gmail.com",
      logoSrc: "logo.png"
    };

    // Intro page logic
    document.getElementById("enter-exam").addEventListener("click", () => {
      document.getElementById("page-intro").style.display = "none";
      document.querySelector(".brand-header").style.display = "flex";
      document.querySelector("main").style.display = "block";
    });

    const SUBJECTS = {
      science: [
        "English Language", "Mathematics", "Biology", "Chemistry", "Physics",
        "Agricultural Science", "Computer Studies", "Civic Education",
        "Geography", "CRS/IRS", "Economics"
      ],
      socialScience: [
        "English Language", "Mathematics", "Economics", "Government", "Geography",
        "Literature in English", "Hausa", "Civic Education", "CRS/IRS", "Commerce",
        "History", "Computer Studies"
      ]
    };
    const ALL_SUBJECTS = Array.from(new Set([...SUBJECTS.science, ...SUBJECTS.socialScience]));

    const students = [
      // Science (30)
      { name: "Amina Yusuf", number: "SSS-2025-S001", field: "Science" },
      { name: "Bello Ibrahim", number: "SSS-2025-S002", field: "Science" },
      { name: "Chinedu Okeke", number: "SSS-2025-S003", field: "Science" },
      { name: "Damilola Ade", number: "SSS-2025-S004", field: "Science" },
      { name: "Emeka Nwosu", number: "SSS-2025-S005", field: "Science" },
      { name: "Faisal Ahmed", number: "SSS-2025-S006", field: "Science" },
      { name: "Grace Eze", number: "SSS-2025-S007", field: "Science" },
      { name: "Hassan Musa", number: "SSS-2025-S008", field: "Science" },
      { name: "Ifunanya Obi", number: "SSS-2025-S009", field: "Science" },
      { name: "Jide Afolayan", number: "SSS-2025-S010", field: "Science" },
      { name: "Khadija Sani", number: "SSS-2025-S011", field: "Science" },
      { name: "Lukman Sule", number: "SSS-2025-S012", field: "Science" },
      { name: "Mustapha Ali", number: "SSS-2025-S013", field: "Science" },
      { name: "Ngozi Umeh", number: "SSS-2025-S014", field: "Science" },
      { name: "Olamide Kayode", number: "SSS-2025-S015", field: "Science" },
      { name: "Paul James", number: "SSS-2025-S016", field: "Science" },
      { name: "Queen Etim", number: "SSS-2025-S017", field: "Science" },
      { name: "Rasheed Abdullahi", number: "SSS-2025-S018", field: "Science" },
      { name: "Samuel Udo", number: "SSS-2025-S019", field: "Science" },
      { name: "Tosin Aramide", number: "SSS-2025-S020", field: "Science" },
      { name: "Umar Sadiq", number: "SSS-2025-S021", field: "Science" },
      { name: "Victoria Ene", number: "SSS-2025-S022", field: "Science" },
      { name: "Wale Adedeji", number: "SSS-2025-S023", field: "Science" },
      { name: "Yusuf Garba", number: "SSS-2025-S024", field: "Science" },
      { name: "Zainab Lawal", number: "SSS-2025-S025", field: "Science" },
      { name: "Abdulrahman Tijjani", number: "SSS-2025-S026", field: "Science" },
      { name: "Bilkisu Danladi", number: "SSS-2025-S027", field: "Science" },
      { name: "Chisom Nnadi", number: "SSS-2025-S028", field: "Science" },
      { name: "Dominic Ogar", number: "SSS-2025-S029", field: "Science" },
      { name: "Elizabeth Ajayi", number: "SSS-2025-S030", field: "Science" },
      // Social Science (20)
      { name: "Ahmed Musa", number: "SSS-2025-SS031", field: "Social Science" },
      { name: "Blessing John", number: "SSS-2025-SS032", field: "Social Science" },
      { name: "Chioma Umeh", number: "SSS-2025-SS033", field: "Social Science" },
      { name: "David Ekanem", number: "SSS-2025-SS034", field: "Social Science" },
      { name: "Efe Omor", number: "SSS-2025-SS035", field: "Social Science" },
      { name: "Fatima Mohammed", number: "SSS-2025-SS036", field: "Social Science" },
      { name: "Gideon Salisu", number: "SSS-2025-SS037", field: "Social Science" },
      { name: "Hauwa Idris", number: "SSS-2025-SS038", field: "Social Science" },
      { name: "Ibrahim Sulaiman", number: "SSS-2025-SS039", field: "Social Science" },
      { name: "Joy Chukwu", number: "SSS-2025-SS040", field: "Social Science" },
      { name: "Kingsley Uche", number: "SSS-2025-SS041", field: "Social Science" },
      { name: "Linda Nwachukwu", number: "SSS-2025-SS042", field: "Social Science" },
      { name: "Maryam Abdullahi", number: "SSS-2025-SS043", field: "Social Science" },
      { name: "Nelson Okon", number: "SSS-2025-SS044", field: "Social Science" },
      { name: "Peace Yakubu", number: "SSS-2025-SS045", field: "Social Science" },
      { name: "Richard Eze", number: "SSS-2025-SS046", field: "Social Science" },
      { name: "Sophia George", number: "SSS-2025-SS047", field: "Social Science" },
      { name: "Theophilus Ojo", number: "SSS-2025-SS048", field: "Social Science" },
      { name: "Uchechi Madu", number: "SSS-2025-SS049", field: "Social Science" },
      { name: "Vivian Okoli", number: "SSS-2025-SS050", field: "Social Science" },
    ];

    // Populate dropdown with all students
    const studentSelect = document.getElementById("student-select");
    function populateStudentDropdown() {
      studentSelect.innerHTML = '<option value="">-- Select Student --</option>';
      students.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.number;
        opt.textContent = `${s.name} (${s.number})`;
        studentSelect.appendChild(opt);
      });
    }

    function assignSubjectsForStudent(field, examNumber) {
      const pool = field === "Science" ? SUBJECTS.science : SUBJECTS.socialScience;
      const n = 9;
      const arr = [...pool].map(s => ({ s, k: hashCode(examNumber + ":" + s) }));
      arr.sort((a, b) => a.k - b.k);
      return arr.slice(0, n).map(x => x.s);
    }

    function hashCode(str) {
      let h = 0;
      for (let i = 0; i < str.length; i++) { h = (h << 5) - h + str.charCodeAt(i); h |= 0; }
      return h;
    }

    // ===============================
    // Full Question Banks (100 each)
    // Bespoke wording per subject + correct answers (A=0 default; editable in admin)
    // ===============================
    let QUESTION_BANKS = {};
    function generateBanks() {
      QUESTION_BANKS = {};
      ALL_SUBJECTS.forEach(subject => {
        QUESTION_BANKS[subject] = generateSubjectQuestions(subject, 100);
      });
    }

    function generateSubjectQuestions(subject, count) {
      const templates = {
        "English Language": [
          (n)=>`Choose the word that best completes the sentence: "The teacher ${n%2? 'commended':'rebuked'} the student for ${n%3? 'arriving early':'being tardy'}."`,
          (n)=>`Select the synonym of "${n%2? 'benevolent':'candid'}".`,
          (n)=>`Identify the figure of speech in: "Time tiptoes past."`,
          (n)=>`Choose the option with correct punctuation in a complex sentence.`,
        ],
        "Literature in English": [
          (n)=>`In a ${n%2?'poem':'prose'} excerpt, the tone primarily conveys:`,
          (n)=>`Which literary device is evident in "a sea of troubles"?`,
          (n)=>`Character motivation: Why does the protagonist act against convention?`,
          (n)=>`Theme identification: The central idea revolves around:`,
        ],
        "Mathematics": [
          (n)=>`Compute the value of ${n+10} + ${2*n}.`,
          (n)=>`Solve for x in ${n%2? '2x+5=15':'3x-9=0'}.`,
          (n)=>`Find the area of a rectangle with sides ${n%10+5} and ${n%7+3}.`,
          (n)=>`Evaluate the expression: ${(n%5)+2}^2 + ${(n%4)+1}.`,
        ],
        "Biology": [
          (n)=>`Which organelle is primarily responsible for energy production in cells?`,
          (n)=>`Identify the process by which water moves across a semi-permeable membrane.`,
          (n)=>`What is the primary function of the xylem in plants?`,
          (n)=>`Which kingdom includes multicellular eukaryotes that perform photosynthesis?`,
        ],
        "Chemistry": [
          (n)=>`Which bond is formed by sharing of electron pairs?`,
          (n)=>`What is the pH of a ${n%2? 'strong':'weak'} acid likely to be?`,
          (n)=>`Identify the gas evolved when a metal reacts with an acid.`,
          (n)=>`Which separation technique best suits a mixture of dyes?`,
        ],
        "Physics": [
          (n)=>`A body moves with uniform acceleration. Which graph shows velocity vs time?`,
          (n)=>`Calculate the resultant of two perpendicular vectors of ${n%9+3}N and ${n%7+2}N.`,
          (n)=>`Which quantity is a scalar?`,
          (n)=>`Identify the law explaining the relationship between current and potential difference.`,
        ],
        "Geography": [
          (n)=>`Which factor most influences climate in tropical regions?`,
          (n)=>`Identify the landform created by river deposition.`,
          (n)=>`Which map scale represents ${n%2? 'large':'small'} areas in detail?`,
          (n)=>`What is the primary cause of desertification?`,
        ],
        "Agricultural Science": [
          (n)=>`Which soil type has the highest water retention capacity?`,
          (n)=>`Identify the common method for improving soil fertility.`,
          (n)=>`Which farming system prioritizes sustainability and rotation?`,
          (n)=>`The best storage method for grains to prevent pests is:`,
        ],
        "Hausa": [
          (n)=>`Which nutrient primarily builds and repairs body tissues?`,
          (n)=>`Identify the first aid step for a minor burn.`,
          (n)=>`Which organ is responsible for detoxification in the body?`,
          (n)=>`The recommended vaccination schedule helps to prevent:`,
        ],
        "Civic Education": [
          (n)=>`Which principle is central to democratic governance?`,
          (n)=>`Identify the duty of a responsible citizen in elections.`,
          (n)=>`The constitution serves primarily to:`,
          (n)=>`Which institution enforces law and order in society?`,
        ],
        "Economics": [
          (n)=>`Which concept explains consumer choice under budget constraints?`,
          (n)=>`Identify the market structure with many sellers of identical products.`,
          (n)=>`The law of demand states that:`,
          (n)=>`Which measure best indicates overall price level changes?`,
        ],
        "Government": [
          (n)=>`Which arm of government interprets the law?`,
          (n)=>`Identify a feature of federalism.`,
          (n)=>`The rule of law ensures:`,
          (n)=>`Which system allows citizens to elect representatives?`,
        ],
        "Commerce": [
          (n)=>`Which form of business organization involves unlimited liability for a single owner?`,
          (n)=>`Identify a function of a commercial bank.`,
          (n)=>`Which document is issued to request payment for goods supplied?`,
          (n)=>`The primary role of advertising is to:`,
        ],
        "CRS/IRS": [
          (n)=>`Which teaching emphasizes compassion and justice?`,
          (n)=>`Identify a central theme in the Sermon on the Mount/Khutbah.`,
          (n)=>`Which prophet is associated with steadfastness in trials?`,
          (n)=>`The concept of stewardship refers to:`,
        ],
        "History": [
          (n)=>`Which event marked a turning point in pre-colonial West African trade?`,
          (n)=>`Identify a cause of nationalist movements in Africa.`,
          (n)=>`Which leader is associated with anti-colonial resistance?`,
          (n)=>`The Berlin Conference led to:`,
        ],
        "Computer Studies": [
          (n)=>`Which device is primarily used for input?`,
          (n)=>`Identify the correct binary representation of ${n%16}.`,
          (n)=>`Which software type manages hardware resources?`,
          (n)=>`A safe password practice includes:`,
        ]
      };

      const optionSets = {
        "English Language": [
          ["praised", "ignored", "delayed", "confused"],
          ["kind", "hostile", "fragile", "opaque"],
          ["personification", "irony", "hyperbole", "metaphor"],
          ["complex; correctly punctuated", "run-on", "comma splice", "incorrect colon use"]
        ],
        "Literature in English": [
          ["melancholy", "sarcastic", "technical", "apathetic"],
          ["metaphor", "oxymoron", "euphemism", "synecdoche"],
          ["social pressure", "financial gain", "peer jealousy", "random luck"],
          ["identity", "betrayal", "technology", "topography"]
        ],
        "Mathematics": [
          ["value computed", "incorrect sum", "undefined", "not evaluable"],
          ["x=5", "x=3", "x=0", "no solution"],
          ["area value", "perimeter", "volume", "undefined"],
          ["correct evaluation", "negative result", "fraction only", "prime number"]
        ],
        "Biology": [
          ["mitochondria", "ribosome", "lysosome", "nucleus"],
          ["osmosis", "diffusion", "active transport", "endocytosis"],
          ["transport of water", "photosynthesis", "seeds production", "hormone release"],
          ["Plantae", "Fungi", "Protista", "Animalia"]
        ],
        "Chemistry": [
          ["covalent bond", "ionic bond", "metallic bond", "hydrogen bond"],
          ["low pH", "neutral", "high pH", "variable"],
          ["hydrogen", "oxygen", "nitrogen", "carbon dioxide"],
          ["chromatography", "filtration", "distillation", "decantation"]
        ],
        "Physics": [
          ["straight line", "parabola", "horizontal", "irregular"],
          ["sqrt(a^2+b^2)", "a+b", "a-b", "a*b"],
          ["mass", "force", "momentum", "acceleration"],
          ["Ohm's law", "Newton's law", "Hooke's law", "Kirchhoff's law"]
        ],
        "Geography": [
          ["latitude", "altitude", "population", "industry"],
          ["delta", "canyon", "karst", "plateau"],
          ["large scale", "small scale", "sketch", "orthophoto"],
          ["deforestation", "urbanization", "rainfall", "volcanism"]
        ],
        "Agricultural Science": [
          ["clay", "sand", "loam", "silt"],
          ["manuring", "overgrazing", "burning", "salting"],
          ["crop rotation", "monoculture", "slash-and-burn", "fallowing only"],
          ["airtight silos", "open baskets", "wooden crates", "exposed bins"]
        ],
        "Hausa": [
          ["proteins", "carbohydrates", "fats", "vitamins"],
          ["cool water", "butter", "tight bandage", "hot compress"],
          ["liver", "heart", "kidney", "spleen"],
          ["infectious diseases", "injuries", "genetic traits", "aging"]
        ],
        "Civic Education": [
          ["separation of powers", "autocracy", "censorship", "nepotism"],
          ["vote honestly", "avoid polls", "sell votes", "spread rumors"],
          ["limit government power", "promote censorship", "mandate wealth", "abolish courts"],
          ["police", "library", "school", "bank"]
        ],
        "Economics": [
          ["utility maximization", "market failure", "inflation", "scarcity only"],
          ["perfect competition", "monopoly", "oligopoly", "duopoly"],
          ["inverse relation of price and quantity demanded", "direct relation always", "unrelated", "random"],
          ["CPI", "GDP", "GNP", "PPP only"]
        ],
        "Government": [
          ["judiciary", "executive", "legislature", "civil service"],
          ["division of powers", "unitary control", "single party", "hereditary rule"],
          ["equality before the law", "privilege for elites", "military rule", "tax exemption"],
          ["representative democracy", "dictatorship", "theocracy", "absolute monarchy"]
        ],
        "Commerce": [
          ["sole proprietorship", "partnership", "limited liability company", "cooperative"],
          ["accept deposits", "draft laws", "create textbooks", "survey fields"],
          ["invoice", "receipt", "quotation", "delivery note"],
          ["inform & persuade", "confuse buyers", "reduce quality", "hide prices"]
        ],
        "CRS/IRS": [
          ["mercy", "vengeance", "deceit", "avarice"],
          ["righteous living", "materialism", "idolatry", "anarchy"],
          ["Job", "Pharaoh", "Herod", "Cain"],
          ["care for creation", "hoard resources", "despise nature", "neglect duties"]
        ],
        "History": [
          ["shift from caravan to coastal trade", "end of barter", "rise of currencies only", "decline of agriculture"],
          ["colonial exploitation", "abundant rainfall", "monarchic traditions", "global peace"],
          ["Samori Ture", "Caesar", "Napoleon", "Shaka Zulu only"],
          ["partition of Africa", "industrialization", "end of slavery", "birth of UN"],
        ],
        "Computer Studies": [
          ["keyboard", "printer", "monitor", "speaker"],
          ["binary value", "hex only", "ASCII", "decimal"],
          ["operating system", "spreadsheet", "browser", "compiler alone"],
          ["use long, unique passwords", "share passwords", "use '12345'", "write on desk"]
        ]
      };

      const list = [];
      for (let i = 1; i <= count; i++) {
        const tset = templates[subject] || [(n)=>`General question ${n}. Choose the correct option.`];
        const oset = optionSets[subject] || [["Option A","Option B","Option C","Option D"]];
        const t = tset[i % tset.length](i);
        const idx = i % oset.length;
        const options = oset[idx];
        const correctIndex = 0; // default A; can be changed in admin

        list.push({
          id: subject.slice(0,3).toUpperCase() + "-" + String(i).padStart(3,"0"),
          text: t,
          options: options,
          answer: correctIndex
        });
      }
      return list;
    }

    // Generate banks initially
    generateBanks();

    // ===============================
    // App State
    // ===============================
    let currentStudent = null;
    let assignedSubjects = [];
    let currentSubject = null;
    let currentExam = null; // { questions40, answers[], pageIndex, timeLeftSec }
    let timerInterval = null;
    let adminAuthed = false;
    let adminCurrentSubject = ALL_SUBJECTS[0];
    const RESULTS = [];

    // Restore banks and results if present
    (function restoreData(){
      const savedBanks = localStorage.getItem("QUESTION_BANKS");
      if (savedBanks) {
        try { QUESTION_BANKS = JSON.parse(savedBanks); } catch(e){}
      }
      const savedResults = localStorage.getItem("RESULTS");
      if (savedResults) {
        try { RESULTS.push(...JSON.parse(savedResults)); } catch(e){}
      }
    })();

    // ===============================
    // Navigation helpers
    // ===============================
    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // ===============================
    // Bind header admin button
    // ===============================
    document.getElementById("go-admin").addEventListener("click", () => {
      showPage("page-admin");
    });

    // Populate student dropdown at start
    populateStudentDropdown();

    // ===============================
    // Landing page logic
    // ===============================
    document.getElementById("proceed-landing").addEventListener("click", () => {
      const num = studentSelect.value;
      if (!num) { alert("Please select a student."); return; }
      const rosterMatch = students.find(s => s.number === num);
      if (!rosterMatch) { alert("Invalid selection."); return; }
      currentStudent = rosterMatch;

      assignedSubjects = assignSubjectsForStudent(currentStudent.field, currentStudent.number);
      const select = document.getElementById("subject-select");
      select.innerHTML = "";
      assignedSubjects.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s; opt.textContent = s;
        select.appendChild(opt);
      });

      document.getElementById("welcome-text").textContent =
        `Hello ${currentStudent.name} (${currentStudent.number}) — Department: ${currentStudent.field}. Select a subject to begin.`;

      showPage("page-select");
    });

    document.getElementById("back-to-landing").addEventListener("click", () => showPage("page-landing"));

    // ===============================
    // Subject selection → Exam init
    // ===============================
    document.getElementById("proceed-exam").addEventListener("click", () => {
      const subject = document.getElementById("subject-select").value;
      if (!subject) { alert("Please select a subject."); return; }
      currentSubject = subject;

      const bank = QUESTION_BANKS[currentSubject];
      const shuffled = [...bank].map(q => ({ q, k: Math.random() })).sort((a,b) => a.k - b.k).map(x => x.q);
      const forty = shuffled.slice(0, 40);

      currentExam = {
        questions40: forty,
        answers: Array(40).fill(null),
        pageIndex: 0,
        timeLeftSec: 30 * 60
      };

      document.getElementById("exam-subject-title").textContent = currentSubject;
      document.getElementById("exam-student-info").textContent =
        `${currentStudent.name} • ${currentStudent.number} • ${currentStudent.field}`;

      renderNumberGrid();
      renderQuestionsPage();
      updateTimerDisplay();

      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        currentExam.timeLeftSec -= 1;
        updateTimerDisplay();
        if (currentExam.timeLeftSec <= 0) { clearInterval(timerInterval); autoSubmit(); }
      }, 1000);

      showPage("page-exam");
    });

    // ===============================
    // Exam rendering
    // ===============================
    function renderNumberGrid() {
      const grid = document.getElementById("number-grid");
      grid.innerHTML = "";
      currentExam.answers.forEach((ans, idx) => {
        const div = document.createElement("div");
        div.className = "num" + (ans !== null ? " answered" : "") + (Math.floor(idx/10) === currentExam.pageIndex ? " active" : "");
        div.textContent = (idx + 1);
        div.addEventListener("click", () => {
          currentExam.pageIndex = Math.floor(idx / 10);
          renderQuestionsPage();
          renderNumberGrid();
        });
        grid.appendChild(div);
      });
    }

    function renderQuestionsPage() {
      const container = document.getElementById("questions-container");
      container.innerHTML = "";
      const start = currentExam.pageIndex * 10;
      const end = start + 10;
      const slice = currentExam.questions40.slice(start, end);
      slice.forEach((q, i) => {
        const globalIndex = start + i;
        const card = document.createElement("div");
        card.className = "question";
        const title = document.createElement("h4");
        title.textContent = `Q${globalIndex + 1}. ${q.text}`;
        const options = document.createElement("div");
        options.className = "options";

        q.options.forEach((opt, oi) => {
          const id = `q${globalIndex}_o${oi}`;
          const label = document.createElement("label");
          const radio = document.createElement("input");
          radio.type = "radio"; radio.name = `q${globalIndex}`; radio.id = id; radio.value = oi;
          radio.checked = (currentExam.answers[globalIndex] === oi);
          radio.addEventListener("change", () => {
            currentExam.answers[globalIndex] = oi;
            renderNumberGrid();
          });
          label.appendChild(radio);
          const span = document.createElement("span");
          span.textContent = ` ${String.fromCharCode(65 + oi)}. ${opt}`;
          label.appendChild(span);
          options.appendChild(label);
        });

        card.appendChild(title);
        card.appendChild(options);
        container.appendChild(card);
      });

      document.getElementById("prev-page").disabled = currentExam.pageIndex === 0;
      document.getElementById("next-page").disabled = currentExam.pageIndex === 3;
    }

    document.getElementById("prev-page").addEventListener("click", () => {
      if (currentExam.pageIndex > 0) { currentExam.pageIndex -= 1; renderQuestionsPage(); renderNumberGrid(); }
    });
    document.getElementById("next-page").addEventListener("click", () => {
      if (currentExam.pageIndex < 3) { currentExam.pageIndex += 1; renderQuestionsPage(); renderNumberGrid(); }
    });

    function updateTimerDisplay() {
      const m = Math.floor(currentExam.timeLeftSec / 60);
      const s = currentExam.timeLeftSec % 60;
      document.getElementById("timer").textContent = `Time left: ${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    }

    // ===============================
    // Submit & Result
    // ===============================
    document.getElementById("submit-exam").addEventListener("click", () => {
      if (!confirm("Submit this test?")) return;
      finalizeSubmission();
    });

    function autoSubmit() {
      alert("Time has elapsed. Submitting your test.");
      finalizeSubmission();
    }

    function finalizeSubmission() {
      if (timerInterval) clearInterval(timerInterval);

      const score = currentExam.answers.reduce((acc, ans, idx) => {
        const correct = currentExam.questions40[idx].answer;
        return acc + (ans === correct ? 1 : 0);
      }, 0);
      const total = currentExam.answers.length;
      const pct = Math.round((score / total) * 100);

      const summary = `${school.name} • ${school.examTitle}
Student: ${currentStudent.name} • ${currentStudent.number}
Department: ${currentStudent.field}
Subject: ${currentSubject}
Score: ${score}/${total} (${pct}%)`;

      const resEl = document.getElementById("result-summary");
      resEl.textContent = summary;
      resEl.className = "score " + (pct >= 70 ? "success" : pct >= 50 ? "warning" : "error");

      showPage("page-result");

      const resultObj = {
        student: currentStudent,
        subject: currentSubject,
        score, total, pct,
        timestamp: new Date().toLocaleString()
      };
      RESULTS.push(resultObj);
      localStorage.setItem("RESULTS", JSON.stringify(RESULTS));
      renderAdminResults();

      window.__lastResult = { school, ...resultObj };
    }

    // ===============================
    // PDF via jsPDF (formatted)
    // ===============================
    document.getElementById("download-pdf").addEventListener("click", async () => {
      const doc = await buildJsPdf();
      doc.save(`${window.__lastResult.student.number}_${window.__lastResult.subject}_result.pdf`);
    });

    document.getElementById("email-pdf").addEventListener("click", async () => {
      const doc = await buildJsPdf();
      const pdfDataUri = doc.output("datauristring"); // "data:application/pdf;base64,..."
      const base64 = pdfDataUri.split(",")[1];

      const params = {
        to_email: school.email,
        school_name: school.name,
        exam_title: school.examTitle,
        student_name: window.__lastResult.student.name,
        exam_number: window.__lastResult.student.number,
        subject: window.__lastResult.subject,
        score_text: `${window.__lastResult.score}/${window.__lastResult.total} (${window.__lastResult.pct}%)`,
        pdf_base64: base64
      };

      const SERVICE_ID = "your_service_id";   // replace
      const TEMPLATE_ID = "your_template_id"; // replace

      try {
        await emailjs.send(SERVICE_ID, TEMPLATE_ID, params);
        alert("Result PDF emailed to school.");
      } catch (e) {
        alert("Failed to email via EmailJS. Check your service/template IDs and template variables.");
      }
    });

    async function buildJsPdf() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });
      const margin = 50;
      const line = (y)=>{ doc.setDrawColor(180); doc.line(margin, y, 595 - margin, y); };

      try {
        const logoEl = document.getElementById("school-logo");
        const logoDataUrl = await imageToDataURL(logoEl.src);
        doc.addImage(logoDataUrl, "PNG", margin, margin, 60, 60);
      } catch(e) {}

      doc.setFont("Times", "bold");
      doc.setFontSize(16);
      doc.text(school.name, margin + 70, margin + 20);
      doc.setFont("Times", "normal");
      doc.setFontSize(12);
      doc.text(school.examTitle, margin + 70, margin + 40);
      line(margin + 70);

      const r = window.__lastResult;
      let y = margin + 110;
      doc.setFont("Times", "bold"); doc.setFontSize(13);
      doc.text("Result", margin, y); y += 10; line(y); y += 20;

      doc.setFont("Times", "normal"); doc.setFontSize(12);
      doc.text(`Student: ${r.student.name}`, margin, y); y += 18;
      doc.text(`Exam Number: ${r.student.number}`, margin, y); y += 18;
      doc.text(`Department: ${r.student.field}`, margin, y); y += 18;
      doc.text(`Subject: ${r.subject}`, margin, y); y += 18;
      doc.setFont("Times", "bold");
      doc.text(`Score: ${r.score}/${r.total} (${r.pct}%)`, margin, y); y += 24;
      doc.setFont("Times", "normal");
      doc.text(`Date: ${new Date().toLocaleString()}`, margin, y);

      doc.setFontSize(10);
      doc.text("Generated by SSCE Examination System", margin, 820 - margin);

      return doc;
    }

    async function imageToDataURL(url) {
      const resp = await fetch(url);
      const blob = await resp.blob();
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
      });
    }

    // ===============================
    // Admin panel
    // ===============================
    document.getElementById("admin-login-btn").addEventListener("click", () => {
      const name = document.getElementById("admin-name").value.trim();
      const pass = document.getElementById("admin-pass").value.trim();
      if (name === "baitussalam" && pass === "756254@Mk") {
        adminAuthed = true;
        document.getElementById("admin-auth").style.display = "none";
        document.getElementById("admin-area").style.display = "block";
        renderAdminSidebar();
        renderAdminEditor(adminCurrentSubject);
        renderAdminResults();
      } else {
        alert("Invalid admin credentials.");
      }
    });

    document.getElementById("admin-back").addEventListener("click", () => {
      showPage("page-landing");
    });

    function renderAdminSidebar() {
      const box = document.getElementById("admin-subject-list");
      box.innerHTML = "";
      ALL_SUBJECTS.forEach(sub => {
        const div = document.createElement("div");
        div.className = "admin-subject" + (sub === adminCurrentSubject ? " active" : "");
        div.textContent = sub;
        div.addEventListener("click", () => {
          adminCurrentSubject = sub;
          renderAdminSidebar();
          renderAdminEditor(sub);
        });
        box.appendChild(div);
      });
    }

    function renderAdminEditor(subject) {
      document.getElementById("admin-subject-title").textContent = subject + " — 100 questions";
      const container = document.getElementById("admin-question-list");
      container.innerHTML = "";
      const bank = QUESTION_BANKS[subject];

      bank.forEach((q, i) => {
        const row = document.createElement("div");
        row.className = "question-row";
        const qLabel = document.createElement("div");
        qLabel.innerHTML = `<strong>Q${i+1}:</strong> <span class="badge">${q.id}</span>`;
        const qText = document.createElement("textarea");
        qText.value = q.text; qText.rows = 2;
        qText.addEventListener("change", () => { q.text = qText.value; });

        const optsWrap = document.createElement("div");
        optsWrap.className = "row";
        q.options.forEach((opt, idx) => {
          const f = document.createElement("div");
          f.className = "field";
          const lab = document.createElement("label");
          lab.textContent = `Option ${String.fromCharCode(65 + idx)}`;
          const inp = document.createElement("input");
          inp.type = "text"; inp.value = opt;
          inp.addEventListener("change", () => { q.options[idx] = inp.value; });
          f.appendChild(lab); f.appendChild(inp);
          optsWrap.appendChild(f);
        });

        const ansField = document.createElement("div");
        ansField.className = "field";
        const ansLab = document.createElement("label");
        ansLab.textContent = "Correct answer (A–D)";
        const ansSel = document.createElement("select");
        ["A","B","C","D"].forEach((l,ix)=>{
          const optEl = document.createElement("option");
          optEl.value = ix; optEl.textContent = l;
          if (q.answer === ix) optEl.selected = true;
          ansSel.appendChild(optEl);
        });
        ansSel.addEventListener("change", () => { q.answer = parseInt(ansSel.value, 10); });
        ansField.appendChild(ansLab); ansField.appendChild(ansSel);

        row.appendChild(qLabel);
        row.appendChild(qText);
        row.appendChild(optsWrap);
        row.appendChild(ansField);
        container.appendChild(row);
      });
    }

    document.getElementById("regen-banks").addEventListener("click", () => {
      if (!confirm("Regenerate all 100-question banks for every subject? This will overwrite current data (unless saved).")) return;
      generateBanks();
      renderAdminEditor(adminCurrentSubject);
      alert("Question banks regenerated.");
    });

    document.getElementById("save-banks").addEventListener("click", () => {
      localStorage.setItem("QUESTION_BANKS", JSON.stringify(QUESTION_BANKS));
      alert("Question banks saved to localStorage.");
    });

    document.getElementById("load-banks").addEventListener("click", () => {
      const raw = localStorage.getItem("QUESTION_BANKS");
      if (!raw) { alert("No saved banks in localStorage."); return; }
      try {
        const parsed = JSON.parse(raw);
        Object.keys(parsed).forEach(k=>QUESTION_BANKS[k]=parsed[k]);
        renderAdminEditor(adminCurrentSubject);
        alert("Question banks loaded from localStorage.");
      } catch(e) {
        alert("Failed to load saved banks.");
      }
    });

    function renderAdminResults() {
      const tbody = document.querySelector("#results-table tbody");
      if (!tbody) return;
      tbody.innerHTML = "";
      RESULTS.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.student.name}</td>
          <td>${r.student.number}</td>
          <td>${r.student.field}</td>
          <td>${r.subject}</td>
          <td>${r.score}/${r.total}</td>
          <td>${r.pct}%</td>
          <td>${r.timestamp}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ===============================
    // Result actions
    // ===============================
    document.getElementById("new-subject").addEventListener("click", () => {
      showPage("page-select");
    });

    // ===============================
    // Safety: leave page warning
    // ===============================
    window.addEventListener("beforeunload", (e) => {
      if (document.getElementById("page-exam").classList.contains("active")) {
        e.preventDefault(); e.returnValue = "";
      }
    });
    // Home navigation buttons
    
    document.getElementById("home-header-btn").addEventListener("click", () => showPage("page-landing"));

    document.getElementById("home-btn-landing").addEventListener("click", () => showPage("page-landing"));

    document.getElementById("home-btn-exam").addEventListener("click", () => {

      if (confirm("Are you sure you want to exit the exam and return home?")) {

        if (timerInterval) clearInterval(timerInterval);

        showPage("page-landing");

      }

    });

    document.getElementById("back-admin-home").addEventListener("click", () => showPage("page-landing"));
  </script>
</body>
</html>


